import{r as l,a as p,j as e,$ as v,S as b}from"./app-BBpXaxM-.js";import{S as i}from"./sweetalert2.esm.all-BQIkj5Wb.js";const E=({id:d})=>{const[n,m]=l.useState({id:d,name:"",permissions:[]}),[t,x]=l.useState({}),[u,h]=l.useState(!1),[g,f]=l.useState(!0);l.useEffect(()=>{var a;const r=(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content");r&&(p.defaults.headers.common["X-CSRF-TOKEN"]=r)},[]),l.useEffect(()=>{d&&(async()=>{try{f(!0);const a=await p.get(`/api/roles/${d}/edit`),o=a.data.role,s=a.data.permissions.map(c=>({id:c.id,name:c.name,checked:c.checked||!1}));m({id:o.id,name:o.name,permissions:s})}catch(a){console.error("Error fetching role data:",a),i.fire("Error","Failed to load role data.","error")}finally{f(!1)}})()},[d]);const y=(r,a)=>{const o=n.permissions.map((s,c)=>c===r?{...s,checked:a}:s);m(s=>({...s,permissions:o}))},j=async r=>{r.preventDefault(),h(!0),x({});const a=n.permissions.filter(s=>s.checked).map(s=>({name:s.name})),o={name:n.name,permissions:a};try{(await p.put(`/roles/${n.id}`,o,{headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).data.success&&(await i.fire("Updated","Role updated successfully","success"),b.get("/admin/roles"))}catch(s){console.error("Update error:",s),s.response?s.response.status===422?(x(s.response.data.errors||{}),i.fire("Validation Error","Please check the form for errors.","error")):s.response.status===404?i.fire("Error","Role not found.","error"):i.fire("Error",s.response.data.message||"There was an error updating the role.","error"):s.request?i.fire("Error","No response from server. Please check your connection.","error"):i.fire("Error","An unexpected error occurred.","error")}finally{h(!1)}},N=()=>{b.get("/admin/roles")};return g?e.jsx("div",{className:"mx-auto max-w-4xl py-6",children:e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"text-lg",children:"Loading role data..."})})}):e.jsxs("div",{className:"mx-auto max-w-4xl py-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Edit Role"}),e.jsx(v,{href:"/admin/roles",className:"text-blue-600 hover:text-blue-800",children:"← Back to Roles"})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6 rounded-lg bg-white p-6 shadow-md",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Role Name"}),e.jsx("input",{type:"text",id:"name",value:n.name,onChange:r=>m(a=>({...a,name:r.target.value})),className:`mt-1 block w-full rounded-md border px-3 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 ${t.name?"border-red-300":"border-gray-300"}`,required:!0}),t.name&&e.jsx("span",{className:"mt-1 block text-sm text-red-600",children:Array.isArray(t.name)?t.name[0]:t.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Permissions"}),e.jsx("div",{className:`grid max-h-64 grid-cols-2 gap-2 overflow-y-auto rounded border p-3 ${t.permissions?"border-red-300":"border-gray-300"}`,children:n.permissions.length>0?n.permissions.map((r,a)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`permission-${r.id}`,checked:r.checked,onChange:o=>y(a,o.target.checked),className:"mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:`permission-${r.id}`,className:"cursor-pointer text-sm text-gray-700",children:r.name})]},r.id)):e.jsx("div",{className:"col-span-2 py-4 text-center text-gray-500",children:"No permissions available"})}),t.permissions&&e.jsx("span",{className:"mt-1 block text-sm text-red-600",children:Array.isArray(t.permissions)?t.permissions[0]:t.permissions})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:u,className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:u?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:N,disabled:u,className:"rounded-md bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400 disabled:opacity-50",children:"Cancel"})]})]})]})};export{E as default};
