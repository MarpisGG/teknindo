import{K as N,r as c,j as s,$ as w,S as g}from"./app-eujjRd3E.js";import{R as B}from"./index-BhKsk9Ti.js";import{S as f}from"./sweetalert2.esm.all-BQIkj5Wb.js";const $=()=>{const{blog:l}=N().props,[o,j]=c.useState((l==null?void 0:l.title)||""),[m,b]=c.useState(null),[d,u]=c.useState(l!=null&&l.thumbnail?`${l.thumbnail}`:null),[i,r]=c.useState(()=>((l==null?void 0:l.contents)??[]).map(e=>({type:e.type,content:e.content||"",image:null,existingImageUrl:e.image?`${e.image}`:void 0,order:e.order})).sort((e,t)=>e.order-t.order)),p=e=>{r([...i,{type:e,content:"",image:null}])},y=e=>{const t=[...i];t.splice(e,1),r(t)},h=(e,t)=>{const a=[...i],n=t==="up"?e-1:e+1;n<0||n>=a.length||([a[e],a[n]]=[a[n],a[e]],r(a))},x=(e,t,a)=>{const n=[...i];a==="text"?n[e].content=t:(n[e].image=t,n[e].existingImageUrl=void 0),r(n)},v=async e=>{e.preventDefault();const t=new FormData;t.append("title",o),m&&t.append("thumbnail",m),i.forEach((a,n)=>{t.append(`contents[${n}][type]`,a.type),a.type==="text"&&t.append(`contents[${n}][content]`,a.content||""),a.type==="image"&&(a.image?t.append(`contents[${n}][image]`,a.image):a.existingImageUrl&&t.append(`contents[${n}][existing_image]`,a.existingImageUrl)),t.append(`contents[${n}][order]`,String(n))}),t.append("_method","PUT");try{await g.post(`/blogs/${l==null?void 0:l.id}`,t,{forceFormData:!0,onSuccess:()=>{f.fire("Success","Blog updated successfully.","success").then(()=>{g.visit("/admin/blogs")})}})}catch{f.fire("Error","An error occurred while updating the blog.","error")}};return s.jsxs("div",{className:"mx-auto max-w-3xl p-6",children:[s.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Edit Blog"}),s.jsx(w,{href:"/admin/blogs",className:"text-blue-600 hover:text-blue-800",children:"← Back to Blogs"})]}),s.jsxs("form",{onSubmit:v,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block font-medium",children:"Title"}),s.jsx("input",{type:"text",value:o,onChange:e=>j(e.target.value),className:"w-full rounded border p-2",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block font-medium",children:"Thumbnail (optional)"}),s.jsx("input",{type:"file",onChange:e=>{var a;const t=((a=e.target.files)==null?void 0:a[0])||null;b(t),t&&t instanceof File?u(URL.createObjectURL(t)):u(null)},className:"w-full"}),d&&s.jsx("img",{src:d,alt:"Thumbnail Preview",className:"mt-4 h-32 w-32 rounded object-cover"})]}),s.jsx("div",{className:"space-y-6",children:i.map((e,t)=>s.jsxs("div",{className:"relative space-y-2 rounded border p-4",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"font-semibold capitalize",children:[e.type," Block"]}),s.jsxs("div",{className:"space-x-2",children:[s.jsx("button",{type:"button",onClick:()=>h(t,"up"),className:"text-sm text-blue-500",children:"↑"}),s.jsx("button",{type:"button",onClick:()=>h(t,"down"),className:"text-sm text-blue-500",children:"↓"}),s.jsx("button",{type:"button",onClick:()=>y(t),className:"text-sm text-red-500",children:"Remove"})]})]}),e.type==="text"&&s.jsx(B,{value:e.content||"",onChange:a=>x(t,a,"text"),className:"bg-white",theme:"snow",placeholder:"Write your text here..."}),e.type==="image"&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"file",accept:"image/*",onChange:a=>{var n;return x(t,((n=a.target.files)==null?void 0:n[0])||null,"image")},className:"w-full"}),e.image instanceof File&&s.jsx("img",{src:URL.createObjectURL(e.image),className:"h-32 w-32 rounded object-cover"}),!e.image&&e.existingImageUrl&&s.jsx("img",{src:e.existingImageUrl,className:"h-32 w-32 rounded object-cover"})]})]},t))}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>p("text"),className:"rounded bg-blue-500 px-4 py-2 text-white",children:"+ Add Text Block"}),s.jsx("button",{type:"button",onClick:()=>p("image"),className:"rounded bg-green-500 px-4 py-2 text-white",children:"+ Add Image Block"})]}),s.jsx("button",{type:"submit",className:"rounded bg-black px-6 py-2 font-medium text-white",children:"Update Blog"})]})]})};export{$ as default};
